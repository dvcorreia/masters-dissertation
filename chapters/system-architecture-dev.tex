\chapter{System Architecture and Development}

\section{Overall architecture}

\section{Hello World}
\todo[inline]{UHF Evaluation: Programs developed to evaluate the system, serialize and deserialize EPCs, Writing valid EPCs}

\section{Cloud and Modern Service Development}
\todo[inline]{Explain Linux containers, Docker and modern service development and deployment}

\section{RFID Serialization Plan}

\section{Identification Keys}

\section{Reader}

Update ao firmware do leitor. origen 5.12.2.240 (Build cbc9ad1d0d1)

\todo[inline]{ver https://support.impinj.com/hc/en-us/articles/360000046899-Reader-Modes-Made-Easy}
\todo[inline]{ver Reader and Gateway compatibility: https://support.impinj.com/hc/en-us/articles/360000046899-Reader-Modes-Made-Easy}
\todo[inline]{quote https://support.impinj.com/hc/en-us/articles/360007414920-Reader-Mode-1002-Autoset-Dense-Reader-Deep-Scan-Overview}

Octane 6.2.0 is based on LLRP version 1.0.1, which does not support C1G2 version 1.2.0.~\cite[sec. 3.1.21]{ImpinjOctaneLLRP}. Octane includes vendor extensions to expose the underlying air protocol features. For more information, refer to the documentation for the individual extensions.

\paragraph{ROBoundarySpec}

This parameter carries the lifetime of the Reader inventory and survey operation.
ROSpecStartTrigger, ROSpecStopTrigger: This is the start and stop trigger for this ROSpec.

Used ROSpecStopTriggerType Periodic.
Periodic trigger values: period - Time period specified in milliseconds; offset - Time offset specified in milliseconds from receiving message to start. useful for one-shot inventory.

Used ROSpecStartTriggerType Periodic.

\paragraph{Antenna inventory operations configuration (AISpec)}

AISpecStopTrigger parameter defines the stop (i.e., terminating boundary) of an antenna inventory operation~\cite[sec. 11.2.2.1]{Llrp1standard20101013Pdf}. Here it was set to Null to Stop when ROSpec is done.

InventoryParameterSpec Configuration (C1G2InventoryCommand) \dots

RF transmitter: Power, hoptableid, channelindex \dots

TagInventoryStateAware flag is used to determine how to process all the C1G2Filter and C1G2Singulation parameters in this command. At a functional level, if the Client is managing the tag states during an inventory operation (i.e., the Client is specifying Class1 Gen2 tag Select command Target and Action values), then it will set that flag to true and pass the appropriate fields in the C1G2 Filter and C1G2 Singulation parameters. If a reader set CanDoTagInventoryStateAwareSingulation to False in LLRPCapabilities (section 10.2.2), then the Reader SHALL ignore the TagInventoryStateAware flag.

The C1G2RFControl parameter~\cite[sec. 3.1.4]{ImpinjOctaneLLRP} specifies Speedway Gen2 modes selected by Impinj system engineering to provide the best performance. No Tari adjustment is necessary. Tari values passed by the client will be ignored.

Mode Index for the use case in this dissertation can be one of the three bellow, depending on the RF environment in which is deployed: 

- (the choice) 1002 (Autoset Static) configures the Reader to choose the best Gen2 link parameters for the environments where the tags population is relatively static and we wish to attempt to search for the weakest tag.

- 1003 (Autoset Static Fast) is an adaptation of Autoset Static for good RF environments

- 1004 (Autoset Static DRM) is an adaptation of Autoset Static for difficult RF environments

This C1G2SingulationControl Parameter provides controls particular to the singulation process in the C1G2 air protocol.

- Tag transit time**: This is the measure of expected tag mobility in the field of view of the antenna where this inventory operation is getting executed.
- **Tag population**: This is the expected tag population in the field of view of the antenna.
- **Session ID**: This is the C1G2 session number that the tags use to update the inventory state upon successful singulation.
- TagInventoryStateAwareSingulationAction: This is not used since the TagInventoryStateAware flag is set to false in the InventoryParameterSpec.

This parameters were not set to let the Impinj mode index use the optimal parameters.

\paragraph{Report Operation Report Spec (ROReportSpec)}

Describes the messages and parameters used in reports, event notifications and keepalives that are generated by the Reader and sent to the Client.

A reporting trigger (ROReportTrigger or AccessReportTrigger) generates a report while a connection is open.

In the use case in this dissertation we are not concerned with near real-time updates on the state of the inventory. So we can reduce the report generation by letting the end of the ROSpec generate a report periodically.
So ROReportTrigger can be set to Upon_N_Tags_Or_End_Of_ROSpec with N=0 (unlimited tag in antenna's field of view)~\cite[sec. 14.2.1]{Llrp1standard20101013Pdf}

In terms of the content useful to retrieve from the reader inventory singulation, the ROSpecID, FirstSeenTimestamp, LastSeenTimestamp are in the interests of the application.

We can enable it the TagReportContentSelector block by setting the Enable in each on.

\paragraph{Impinj Custom Parameters}

Impinj readers support Impinj extensions to the LLRP protocol. This extensions can be disabled by setting their values to zero. This will use the information defined in the LLRP parameters defined above.

One that is worth looking at is the ImpinjInventorySearchMode.
Impinj Readers implement state unaware singulation and therefore the Client does not control how the Reader attempts to singulate tags. This parameter provides a high-level control over the search algorithm and consequently does not interfere with any of the standard LLRP settings.~\cite[sec. 4.3.3]{ImpinjOctaneLLRP}
\todo[color=red]{rewrite}

Value 3, Single Target Inventory with Suppression (aka TagFocus), used for High tag count, high-throughput use cases where a reduction in repeated tag observations is acceptable. Suppresses repeated observations for extended periods of time while tags are energized. Supported only with Monza tags using Session 1. Since the we are using Monza R6-P tags, we can enable this mode.

\paragraph{Tools}

Used Fosstrak LLRP Commander with the old old Eclipse 3.3 and JRE/JDK1.8 to configure de reader using an xml schema.
Also developed a java tool to configure the reader using LLRP. Used the java llrp.ltk and code by impinj to configure it based on the "same" schema used in the LLRP commander.
In the java tool, the xml parser sometimes requires fields that shouldn't be needed because Impinj reader ignores then in certain configuration options. But for the configuration to be validated, they have to be present in order to validate de xsd schema (TagInventoryStateAware, Tari)

\section{Middleware}

\paragraph{LRSpec}

\paragraph{ECSpec}

We have 2 ec reports: one for informing the tag uri added and deleted from the shelve that will be used for the capture application to provide supply chain visualization to the epcis repository; a second for informing the real-time inventory service on the point of sale the current state of inventory (will sent counts for products).

ECSpec2: want only to know the number of which coffee type are available in storage, so SGTIN filter value of 1 (Point of Sale (POS) Trade Item), with nespresso's company prefix, different item references groups and any serial tag number in those groups.

\todo[inline]{Table 10-1 in sec 10.2 TDS : Filter Values for SGTIN EPC Tags}
\todo[inline]{Ref ECReportOutputSpec in 8.2.10 ALE standard core}

\section{Capture application}

\section{EPCIS repository}

\section{Managements application}